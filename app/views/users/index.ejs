<link rel="stylesheet" type="text/css" href="/stylesheets/search.css">

<div class="page-header text-center">
<h1>
	<span>U</span>
	<span>s</span>
	<span>e</span>
	<span>r</span>
	<span>s</span>
</h1>
</div>

<ng-view></ng-view>

<!-- Template -->
<script type="text/ng-template" id="/users.html">
	<div class="form-inline">
		<label>Search: </label>
		<input type="text" class="form-control" ng-model="search.local.username">
	</div>
	<ul class="users-list">
		<li ng-repeat="user in users | filter: search" >
		<br>
			<img class="user-image" ng-src="/users/{{user._id}}/img"  >
        <label class="name" >
           <a href="/users/{{user._id}}">{{user.local.username}}</a>
           <label style="margin-left: 400px;" ng-init="getMutual(user._id)">Mutual Friend(s): {{mutual}}</label>  

          
        </label>
           
        <div class="break"></div>
		</li>
	</ul>
</script>

<script>
	angular.module('app', ['ngRoute'])
		//---------------
		// Controllers
		//---------------
		.controller('UsersController', function ($scope, $http) {
			$http.get('/users', {
				headers: {
					'Accept': 'application/json'
				}
			}).then(function(response) {
				var users = response.data;
				$scope.users = users;
			});

			$scope.getMutual = function (data) {
				$http.get('/users/'+ data +'/mutual', {_csrf: '<%= csrfToken %>'})
				.then(function (result) {
				 
                        $scope.mutual = result["data"].length;

				})
				.error(function (data, status, header, config) {
					alert("fail to load");
				});
			};

		})

		//---------------
		// Routes
		//---------------
		.config(['$routeProvider', function ($routeProvider) {
			$routeProvider
				.when('/', {
					templateUrl: '/users.html',
					controller: 'UsersController'
				});
		}]);
</script>